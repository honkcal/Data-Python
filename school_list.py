import traceback
import requests
import json
##coding:utf-8
import urllib.request
import re
import pyodbc
import time
import os


if __name__ == '__main__':
    try:

        print("connection build")
        conn = pyodbc.connect(r'DRIVER={SQL Server Native Client 10.0};SERVER=;DATABASE=;UID=;PWD=')
        cursor = conn.cursor()
        print("connection build111")

        questjson = '{"query": "\\nquery ins($state: String, $q: String, $include_not_ranked: Boolean, $field_of_study_ranking_key: String, $ranking_key: String, $china_degree: String, $country: String, $field_of_study: String, $offset: Int,$institute_quality:[String],$public_or_private:[String],$institute_type: String,$china_belong_to:[String]) {\\n    institute {\\n      search(state: $state, q: $q, include_not_ranked: $include_not_ranked, field_of_study_ranking_key: $field_of_study_ranking_key, ranking_key: $ranking_key, china_degree: $china_degree, country: $country, field_of_study: $field_of_study, offset: $offset,size:2500,institute_quality: $institute_quality, public_or_private: $public_or_private, institute_type: $institute_type,china_belong_to: $china_belong_to) {\\n        items {\\n          id\\n          slug\\n          name\\n          logo_url\\n          country\\n          country_data\\n          state\\n          city_data\\n          city\\n          ranking {\\n            applysq\\n            arwu\\n            cn_caijinglei15\\n            cn_china15\\n            cn_ligonglei15\\n            cn_minzulei15\\n            cn_nonglinlei15\\n            cn_shifanlei15\\n            cn_tiyulei15\\n            cn_yishulei15\\n            cn_yiyaolei15\\n            cn_yuyanlei15\\n            cn_zhengfalei15\\n            cn_zhuanke16\\n            cn_zonghelei15\\n            fortune500\\n            qs\\n            times\\n            usnews\\n            usnews_global\\n            usnews_liberal_arts_college\\n            usnews_school_business\\n            usnews_school_engineering\\n            usnews_school_fine_arts\\n            usnews_school_law\\n            usnews_school_medical_primary_care\\n            usnews_school_medical_research\\n\\t\\t  }\\n\\t\\t  field_of_study{\\n            accounting {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},actuarial_science {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},aerospace {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},agriculture {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},agriculture_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},animal_science {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},anthropology {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},aquaculture {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},architectural_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},architecture {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},area_studies {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},artistic_theory {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},arts_management {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},atmospheric_science {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},basic_medicine {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},biological_agricultural_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},biological_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},biology {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},biomedical_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},biostatistics {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},business_analytics {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},chemical_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},chemistry {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},civil_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},clinical_medicine {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},communication {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},computer_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},computer_science {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},criminology {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},data_science {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},design {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},drama_and_film {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},economics {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},education {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},electrical_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},electronic_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},english {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},entrepreneurship {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},environmental_construction_and_equipment_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},environmental_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},environmental_science {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},epidemiology {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},exercise_and_sport_science {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},finance {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},financial_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},fine_art {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},fine_arts {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},food_science_and_technology {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},forestry {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},geography {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},geology {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},geophysics {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},geosciences {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},health {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},history {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},human_resource_management {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},industrial_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},information_systems {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},international_business {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},language {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},law {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},literature {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},management {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},marketing {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},materials {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},mathematics {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},mba {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},mechanical_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},medicine {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},mineral_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},music_and_dance {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},natural_conservation_and_ecology {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},nuclear_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},nursing {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},nutrition {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},oceanography {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},operations {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},pharmacy {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},philosophy {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},physics {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},plant_science {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},political_science {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},prataculture {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},psychology {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},public_affairs {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},public_health {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},public_management_administration {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},public_policy_analysis {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},religion {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},social_work {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},sociology {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},software_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},statistics {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},strategy {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},supply_chain_and_logistics {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},textile_and_light_industry {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},urban_planning {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},veterinary_medicine {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},water_resources_engineering {\\n\\t\\t\\t\\t\\t\\t\\tranking{\\n\\t\\t\\t\\t\\t\\t\\t\\tcn\\n\\t\\t\\t\\t\\t\\t\\t\\tapplysq\\n\\t\\t\\t\\t\\t\\t\\t\\tglobal\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t}\\n          }\\n          wikipedia {\\n            localized_name {\\n              cn\\n              en\\n            }\\n          }\\n        }\\n        page_info {\\n          count\\n        }\\n      }\\n    }\\n  }", "variables": {"q": null, "country": null, "state": null, "china_degree": null, "field_of_study": null,  "include_not_ranked": true, "ranking_key": "qs", "offset": 0}}'
        headers = {'Referer': 'https://www.applysquare.com/ranking-cn',
                   'X-CSRFToken': '064dSTdioTFkYAw81iEGj8vCHYtF8egK'}
        cookies = dict(csrftoken='064dSTdioTFkYAw81iEGj8vCHYtF8egK')

        j = requests.post('https://www.applysquare.com/ajax/graphql', data=questjson, headers=headers,
                          cookies=cookies).json()


        print("-------done extract-------")


        i = 0
        for val in j['data']['institute']['search']['items']:
            chinese_name = (val['wikipedia']['localized_name']['cn'])
            english_name = (val['wikipedia']['localized_name']['en'])
            state = (val['state'])
            country_data = (val['country_data'])
            id = (val['id'])
            rank_qs = str(val['ranking']['qs'])
            rank_times = str(val['ranking']['times'])
            rank_arwu = str(val['ranking']['arwu'])
            logo_url = (val['logo_url'])
            # 分类关键字
            #slug = (val['slug'])
            print(val)
            if(chinese_name is None):
                chinese_name=""
            if (english_name is None):
                english_name = ""
            if (state is None):
                state = ""
            if (logo_url is None):
                logo_url = ""

            i = i + 1
            print("------- 第 " + str(i) + " 个学校 -------")
            # 当前时间信息
            ct = time.time()
            # print(time.time())
            local_time = time.localtime(ct)
            data_head = time.strftime("%Y-%m-%d %H:%M:%S", local_time)
            #sql = "INSERT INTO ODS_university_shenqingfang_alllist([university_name])VALUES('" + str(val).replace("'","")+"')"
            #print(chinese_name)

            # 拼出插入University_Master表的sql语句
            sql = "INSERT INTO ODS_university_shenqingfang_master(UniversityName_CN,UniversityName_EN,CountryName,Region,Picture,rank_qs, rank_times,rank_arwu,InsertDate)VALUES('" + \
                  chinese_name.replace("'", "") + "','" + english_name.replace("'", "") + "','" + country_data+ "','" + state.replace("'", "") + "','" +\
                  logo_url.replace("'", "") + "','"+rank_qs.replace("'", "") + "','"+rank_times.replace("'", "") + "','"+rank_arwu.replace("'", "") + "','" + data_head + "')"
            print(chinese_name.replace("'", ""))
            # 执行sql
            cursor.execute(sql)
            # 提交修改
            conn.commit()
            print("-------学校 " + chinese_name.replace("'", "") + " 详细信息采集完成----")


    except :
            traceback.print_exc()

